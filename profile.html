<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="register.css">


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,100..700;1,100..700&family=Nanum+Gothic:wght@400;700;800&family=Playwrite+DE+Grund:wght@100..400&family=Playwrite+IT+Moderna:wght@100..400&display=swap"
        rel="stylesheet">

    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Swiffy slider -->
    <link href="https://cdn.jsdelivr.net/npm/swiffy-slider@1.6.0/dist/css/swiffy-slider.min.css" rel="stylesheet"
        crossorigin="anonymous">
    <title>waterlogging.com</title>

    <style>
        body {

            overflow-x: hidden !important;
            background-color: #dfe4ea!important;
            font-family: "Josefin Sans", sans-serif !important;
            font-optical-sizing: auto;
            font-weight: 700 !important;
            font-style: normal;
            font-style: normal;
            color: aliceblue;
        }

        footer {

            overflow-x: hidden !important;
        }


        main {
            font-family: "Raleway", sans-serif;
            font-optical-sizing: auto;
            font-weight: 700;
            font-style: normal;
        }


        .profile-card {
            max-width: 300px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            background-color: #c8e0f7;
            border-radius: 15px;
            border: 2px solid rgb(83, 148, 245);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .profile-card img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin-top: -120px;
            border: 2px solid rgb(83, 148, 245);
            box-shadow:  0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .profile-card h4 {
            margin-top: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            color: #fd0b0b;
       
        }
        .profile-card p {
            margin-bottom: 5px;
            color: #000000;
        }

    </style>
</head>

<body class="pt-5">
    <header>
        <!-- navbar -->
        <div id="navbar"> </div>


    </header>
    <main class="text-white p-5 pt-5 ">

        <h1 class="text-center text-primary p-5">Welcome to Your Profile page </h1>

        <section class="pt-5">

            <div class="profile-card pt-5"  id="profile-card">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQwyuJc6NEaN9Q_ZMryrT1w_mMGuXDvi9FQh324KPE5wz0rq-rs2K2uGkGws1nrCLC8yCU&usqp=CAU">
                <!-- <h4 >John Doe</h4>
                <p><strong>Username:</strong> None</p>
                <p><strong>Email:</strong> None</p>
                <p><strong>Role:</strong> None</p> -->
            </div>
        </section>

   
    </main>
    <footer>









    </footer>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiffy-slider@1.6.0/dist/js/swiffy-slider.min.js" crossorigin="anonymous"
        defer></script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/js/bootstrap.min.js"></script>
    <script src="index.js"></script>
    <script src="auth.js"></script>
    <script src="logout.js"></script>
    <script src="details.js"></script>
    <script src="./navbar.js"></script>

    <script>
    
    const token = localStorage.getItem('token');

fetch('https://water-backend-api.vercel.app/team/pending_request/', {
    method: 'GET', 
    headers: {
        'Authorization': `Token ${token}`,
        'Content-Type': 'application/json',
    }
})
.then(response => {
    if (!response.ok) {
        throw new Error('Network response was not ok');
    }
    return response.json();
})
.then(data => {

    let table = `
        <table class="table-container table-bordered">
            <thead>
                <tr>
                    <th>Team Name</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Contact Number</th>
                    <th>Request to team</th>
                </tr>
            </thead>
            <tbody>
    `;
    

    data.forEach(request => {
        table += `
            <tr>
                <td>${request.team}</td>
                <td>${request.name}</td>
                <td>${request.email}</td>
                <td>${request.contact_number}</td>
                <td><button class="btn btn-success accept-button" data-id="${request.id}">Accept</button></td>
            </tr>
        `;
    });
    
   
    table += `
            </tbody>
        </table>
    `;
    
   
    document.getElementById('pending-requests').innerHTML = table;


    document.querySelectorAll('.accept-button').forEach(button => {
        button.addEventListener('click', function() {
            const requestId = this.getAttribute('data-id');
            acceptRequest(requestId);
        });
    });
})
.catch(error => {
    console.error('Error:', error);
    document.getElementById('pending-requests').innerHTML = `<p>Error loading data: ${error.message}</p>`;
});

// Function to handle request acceptance

function acceptRequest(requestId) {
    fetch(`https://water-backend-api.vercel.app/team/members/${requestId}/update-status/`, {
        method: 'PATCH',
        headers: {
            'Authorization': `Token ${token}`,
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ 
            is_pending: true,
        })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        console.log('Request accepted:', data);

        // Update the user's role if the request is accepted
        return fetch(`https://water-backend-api.vercel.app/account/api/user-role/`, {
            method: 'PATCH',
            headers: {
                'Authorization': `Token ${token}`,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                role: "volunteer_team"
            })
        });
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Failed to update user role');
        }
        return response.json();
    })
    .then(roleData => {
        console.log('User role updated:', roleData);
        
        // Remove the request row from the table
        document.querySelector(`button[data-id="${requestId}"]`).closest('tr').remove();
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Failed to accept the request or update the user role. Please try again.');
    });
}


    </script>
    

</body>

</html>